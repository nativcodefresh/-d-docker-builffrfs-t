version: '1.0'
steps:
  unit_test_step:
    title: "Executing unit tests..."
    image: node:6.9.2-alpine
    environment:
        - COVERALLS_TOKEN=${{COVERALLS_TOKEN}}
    working_directory: ${{main_clone}}
    commands:
        - npm install
        - npm run no-only
        - npm test
        - npm run lint
        - npm run gulp coveralls
        - npm run clean
    fail_fast: false

  build_step:
    title: "Building step..."
    type: build
    image_name: codefresh/cf-docker-builder

  push_to_registry:
    type: push
    candidate: ${{build_step}}
    tag: ${{CF_BRANCH}}

