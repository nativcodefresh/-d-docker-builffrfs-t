version: '1.0'
steps:
  unit_test_step:
    title: "Executing unit tests..."
    image: node:6.9.2-alpine
    environment:
        - COVERALLS_SERVICE_NAME=codefresh-io
        - COVERALLS_REPO_TOKEN=${{COVERALLS_TOKEN}}
    working_directory: ${{main_clone}}
    commands:
        - npm prune
        - npm install
        - npm run depcheck
        - npm run lint
        - npm run test:coverage
        - npm run coveralls
        - npm run clean

  build_step:
    title: "Building step..."
    type: build
    image_name: codefresh/cf-docker-builder

  push_to_registry:
    type: push
    candidate: ${{build_step}}
    tag: ${{CF_BRANCH}}

